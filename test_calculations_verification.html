<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verifikasi Perhitungan vs Excel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h2 {
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: right;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        .match {
            background-color: #d4edda;
        }
        .mismatch {
            background-color: #f8d7da;
        }
        .total {
            font-weight: bold;
            background-color: #e7f3ff;
        }
    </style>
</head>
<body>
    <h1>üîç Verifikasi Perhitungan vs Excel</h1>
    
    <div class="container">
        <h2>1. Leasing</h2>
        <table>
            <thead>
                <tr>
                    <th>Tahun</th>
                    <th>Lease Payment</th>
                    <th>PV Factor</th>
                    <th>PV Expense (Excel)</th>
                    <th>PV Expense (Calc)</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="leasingTable"></tbody>
        </table>
    </div>

    <div class="container">
        <h2>2. Borrow & Purchase</h2>
        <table>
            <thead>
                <tr>
                    <th>Tahun</th>
                    <th>Principal</th>
                    <th>Interest</th>
                    <th>Maintenance</th>
                    <th>Total Expense</th>
                    <th>PV Factor</th>
                    <th>PV Expense (Excel)</th>
                    <th>PV Expense (Calc)</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="purchaseTable"></tbody>
        </table>
    </div>

    <div class="container">
        <h2>3. Revenue Sharing</h2>
        <table>
            <thead>
                <tr>
                    <th>Tahun</th>
                    <th>Negative EAT</th>
                    <th>PV Factor</th>
                    <th>PV Expense (Excel)</th>
                    <th>PV Expense (Calc)</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="revenueTable"></tbody>
        </table>
    </div>

    <script type="module">
        // Import functions
        const calculatePVFactor = (rate, year) => {
            return 1 / Math.pow(1 + rate / 100, year)
        }

        // Data dari Excel
        const excelData = {
            leasing: [
                { year: 1, payment: 280, pvFactor: 0.909091, pvExpense: 254.545455 },
                { year: 2, payment: 280, pvFactor: 0.826446, pvExpense: 231.404959 },
                { year: 3, payment: 280, pvFactor: 0.751315, pvExpense: 210.368144 },
                { year: 4, payment: 280, pvFactor: 0.683013, pvExpense: 191.243768 },
                { year: 5, payment: 280, pvFactor: 0.620921, pvExpense: 173.85797 }
            ],
            purchase: [
                { year: 1, principal: 260, interest: 130, maintenance: 12, total: 403, pvFactor: 0.909091, pvExpense: 366.363636 },
                { year: 2, principal: 260, interest: 104, maintenance: 12, total: 378, pvFactor: 0.826446, pvExpense: 312.396694 },
                { year: 3, principal: 260, interest: 78, maintenance: 12, total: 353, pvFactor: 0.751315, pvExpense: 265.214125 },
                { year: 4, principal: 260, interest: 52, maintenance: 12, total: 328, pvFactor: 0.683013, pvExpense: 224.028413 },
                { year: 5, principal: 260, interest: 26, maintenance: 12, total: 303, pvFactor: 0.620921, pvExpense: 188.139161 },
                { year: 5, type: 'Trade-in', value: -130, pvFactor: 0.620921, pvExpense: -80.719772 }
            ],
            revenue: [
                { year: 1, negativeEAT: 382.5, pvFactor: 0.909091, pvExpense: 347.727273 },
                { year: 2, negativeEAT: 382.5, pvFactor: 0.826446, pvExpense: 316.115702 },
                { year: 3, negativeEAT: 382.5, pvFactor: 0.751315, pvExpense: 287.377911 },
                { year: 4, negativeEAT: 382.5, pvFactor: 0.683013, pvExpense: 261.252647 },
                { year: 5, negativeEAT: 382.5, pvFactor: 0.620921, pvExpense: 237.502406 }
            ]
        }

        const discountRate = 10

        // Test Leasing
        let leasingHTML = ''
        let leasingTotalExcel = 0
        let leasingTotalCalc = 0
        
        excelData.leasing.forEach(row => {
            const calcPVFactor = calculatePVFactor(discountRate, row.year)
            const calcPVExpense = row.payment * calcPVFactor
            const match = Math.abs(calcPVExpense - row.pvExpense) < 0.01
            
            leasingTotalExcel += row.pvExpense
            leasingTotalCalc += calcPVExpense
            
            leasingHTML += `
                <tr class="${match ? 'match' : 'mismatch'}">
                    <td>${row.year}</td>
                    <td>${row.payment.toFixed(2)}</td>
                    <td>${row.pvFactor.toFixed(6)}</td>
                    <td>${row.pvExpense.toFixed(6)}</td>
                    <td>${calcPVExpense.toFixed(6)}</td>
                    <td>${match ? '‚úÖ' : '‚ùå'}</td>
                </tr>
            `
        })
        
        leasingHTML += `
            <tr class="total">
                <td colspan="3">TOTAL</td>
                <td>${leasingTotalExcel.toFixed(6)}</td>
                <td>${leasingTotalCalc.toFixed(6)}</td>
                <td>${Math.abs(leasingTotalCalc - leasingTotalExcel) < 0.01 ? '‚úÖ' : '‚ùå'}</td>
            </tr>
        `
        document.getElementById('leasingTable').innerHTML = leasingHTML

        // Test Purchase
        let purchaseHTML = ''
        let purchaseTotalExcel = 0
        let purchaseTotalCalc = 0
        
        excelData.purchase.forEach(row => {
            if (row.type === 'Trade-in') {
                const calcPVExpense = row.value * row.pvFactor
                const match = Math.abs(calcPVExpense - row.pvExpense) < 0.01
                
                purchaseTotalExcel += row.pvExpense
                purchaseTotalCalc += calcPVExpense
                
                purchaseHTML += `
                    <tr class="${match ? 'match' : 'mismatch'}">
                        <td>${row.year}</td>
                        <td colspan="4">Trade-in (${Math.abs(row.value)})</td>
                        <td>${row.pvFactor.toFixed(6)}</td>
                        <td>${row.pvExpense.toFixed(6)}</td>
                        <td>${calcPVExpense.toFixed(6)}</td>
                        <td>${match ? '‚úÖ' : '‚ùå'}</td>
                    </tr>
                `
            } else {
                const calcPVFactor = calculatePVFactor(discountRate, row.year)
                const calcPVExpense = row.total * calcPVFactor
                const match = Math.abs(calcPVExpense - row.pvExpense) < 0.01
                
                purchaseTotalExcel += row.pvExpense
                purchaseTotalCalc += calcPVExpense
                
                purchaseHTML += `
                    <tr class="${match ? 'match' : 'mismatch'}">
                        <td>${row.year}</td>
                        <td>${row.principal.toFixed(2)}</td>
                        <td>${row.interest.toFixed(2)}</td>
                        <td>${row.maintenance.toFixed(2)}</td>
                        <td>${row.total.toFixed(2)}</td>
                        <td>${row.pvFactor.toFixed(6)}</td>
                        <td>${row.pvExpense.toFixed(6)}</td>
                        <td>${calcPVExpense.toFixed(6)}</td>
                        <td>${match ? '‚úÖ' : '‚ùå'}</td>
                    </tr>
                `
            }
        })
        
        purchaseHTML += `
            <tr class="total">
                <td colspan="6">TOTAL</td>
                <td>${purchaseTotalExcel.toFixed(6)}</td>
                <td>${purchaseTotalCalc.toFixed(6)}</td>
                <td>${Math.abs(purchaseTotalCalc - purchaseTotalExcel) < 0.01 ? '‚úÖ' : '‚ùå'}</td>
            </tr>
        `
        document.getElementById('purchaseTable').innerHTML = purchaseHTML

        // Test Revenue Sharing
        let revenueHTML = ''
        let revenueTotalExcel = 0
        let revenueTotalCalc = 0
        
        excelData.revenue.forEach(row => {
            const calcPVFactor = calculatePVFactor(discountRate, row.year)
            // PV Expense = |EAT| √ó PV Factor (selalu nilai absolut untuk konsistensi)
            const calcPVExpense = Math.abs(row.negativeEAT) * calcPVFactor
            const match = Math.abs(calcPVExpense - row.pvExpense) < 0.01
            
            revenueTotalExcel += row.pvExpense
            revenueTotalCalc += calcPVExpense
            
            revenueHTML += `
                <tr class="${match ? 'match' : 'mismatch'}">
                    <td>${row.year}</td>
                    <td>${row.negativeEAT.toFixed(2)}</td>
                    <td>${row.pvFactor.toFixed(6)}</td>
                    <td>${row.pvExpense.toFixed(6)}</td>
                    <td>${calcPVExpense.toFixed(6)}</td>
                    <td>${match ? '‚úÖ' : '‚ùå'}</td>
                </tr>
            `
        })
        
        revenueHTML += `
            <tr class="total">
                <td colspan="3">TOTAL</td>
                <td>${revenueTotalExcel.toFixed(6)}</td>
                <td>${revenueTotalCalc.toFixed(6)}</td>
                <td>${Math.abs(revenueTotalCalc - revenueTotalExcel) < 0.01 ? '‚úÖ' : '‚ùå'}</td>
            </tr>
        `
        document.getElementById('revenueTable').innerHTML = revenueHTML

        // Summary
        console.log('=== VERIFIKASI PERHITUNGAN ===')
        console.log('Leasing Total:', leasingTotalCalc.toFixed(2), 'vs Excel:', leasingTotalExcel.toFixed(2))
        console.log('Purchase Total:', purchaseTotalCalc.toFixed(2), 'vs Excel:', purchaseTotalExcel.toFixed(2))
        console.log('Revenue Total:', revenueTotalCalc.toFixed(2), 'vs Excel:', revenueTotalExcel.toFixed(2))
    </script>
</body>
</html>
